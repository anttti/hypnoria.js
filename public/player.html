<!doctype html>
<html>
  <head>
  </head>
  <body>
    <script src="/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/timbre.js"></script>
    <script>
      var sounds = {
        zip: function() {
          var sine1 = T("sin", {freq:440, mul:0.5});
          var sine2 = T("sin", {freq:660, mul:0.5});

          T("perc", {r:500}, sine1, sine2).on("ended", function() {
            this.pause();
          }).bang().play();
        },

        bang: function(freqFrom, time) {
          var table = [freqFrom, [110, time + "ms"]];

          var freq = T("env", {table:table}).on("bang", function() {
              VCO.mul = 0.2;
          }).on("ended", function() {
              VCO.mul = 0;
          });
          var VCO = T("saw", {freq:freq, mul:0}).play();

          freq.bang();  
        }
      }

      var socket = io();
      socket.on('sound-play', function(payload) {
        var parsed = JSON.parse(payload);
        var now = new Date().getTime();
        var latency = now - parsed.timestamp;

        var sound = sounds[parsed.sound];
        console.log(parsed.sound, sound);
        if (sound) {
          sound(parsed.param1, parsed.param2);
        }
      });
    </script>
  </body>
</html>